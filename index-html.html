<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SERP Parser</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { min-height: 100vh; background: #f4f6f9; font-family: 'Segoe UI', sans-serif; padding: 32px 16px; }
    .wrap { max-width: 700px; margin: 0 auto; }
    .header { display: flex; align-items: center; gap: 14px; margin-bottom: 28px; }
    .logo { background: #0D405F; border-radius: 12px; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; font-size: 22px; flex-shrink: 0; }
    h1 { font-size: 22px; font-weight: 800; color: #0D405F; }
    .subtitle { color: #7a8fa6; font-size: 13px; margin-top: 2px; }
    .card { background: #fff; border-radius: 14px; padding: 20px; box-shadow: 0 2px 16px #0d405f12; margin-bottom: 16px; }
    .label { font-size: 11px; font-weight: 700; color: #0D405F; text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 8px; }
    input[type=text], input[type=password] {
      width: 100%; padding: 10px 12px; border-radius: 8px; font-size: 13px;
      border: 1.5px solid #e2e8f0; background: #f8fafc; color: #1e293b;
      outline: none; font-family: monospace; transition: border 0.2s;
    }
    input[type=text]:focus, input[type=password]:focus { border-color: #FF9500; }
    .search-row { display: flex; gap: 10px; }
    .search-row input { flex: 1; font-family: 'Segoe UI', sans-serif; font-size: 14px; }
    .btn-orange {
      background: linear-gradient(135deg, #FF9500, #e07800); color: #fff;
      border: none; border-radius: 8px; padding: 11px 24px; font-size: 14px;
      font-weight: 700; cursor: pointer; white-space: nowrap;
      box-shadow: 0 4px 16px #ff950044; transition: all 0.2s;
    }
    .btn-orange:disabled { background: #e2e8f0; color: #94a3b8; box-shadow: none; cursor: default; }
    .btn-blue {
      background: #0D405F; color: #fff; border: none; border-radius: 8px;
      padding: 10px 18px; font-size: 13px; font-weight: 700; cursor: pointer;
      box-shadow: 0 2px 12px #0d405f44;
    }
    .hint { margin-top: 8px; font-size: 11px; color: #94a3b8; }
    .ok { margin-top: 10px; font-size: 12px; color: #22c55e; font-weight: 600; }
    .error { background: #fff0f0; border: 1.5px solid #fca5a5; border-radius: 12px; padding: 16px; margin-bottom: 20px; color: #dc2626; font-size: 13px; font-weight: 600; }
    .loading { text-align: center; padding: 40px; }
    .loading .icon { font-size: 32px; margin-bottom: 12px; }
    .loading .title { color: #0D405F; font-weight: 700; font-size: 15px; }
    .loading .sub { color: #94a3b8; font-size: 12px; margin-top: 6px; }
    .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; flex-wrap: wrap; gap: 10px; }
    .badge { background: #0D405F18; color: #0D405F; border-radius: 20px; padding: 2px 9px; font-size: 11px; font-weight: 700; margin-left: 8px; }
    .badge-orange { background: #FF950018; color: #FF9500; }
    .section-title { font-size: 12px; font-weight: 700; color: #0D405F; text-transform: uppercase; letter-spacing: 1px; }
    .section-title-orange { color: #FF9500; }
    .btns { display: flex; gap: 8px; flex-wrap: wrap; }
    .result-card {
      border-radius: 10px; border: 1.5px solid #f1f5f9; padding: 14px;
      margin-bottom: 10px; background: #fafcff; transition: border 0.2s, box-shadow 0.2s;
    }
    .result-card:hover { border-color: #0D405F33; box-shadow: 0 2px 12px #0d405f0f; }
    .result-meta { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .pos { background: #0D405F; color: #fff; font-weight: 800; font-size: 11px; border-radius: 6px; padding: 3px 8px; flex-shrink: 0; }
    .source { font-size: 12px; color: #94a3b8; font-weight: 600; }
    .url { font-size: 11px; color: #FF9500; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1; text-decoration: none; }
    .row { display: flex; gap: 8px; align-items: flex-start; margin-bottom: 6px; }
    .tag { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; border-radius: 4px; padding: 2px 6px; flex-shrink: 0; margin-top: 2px; }
    .tag-blue { color: #0D405F; background: #0D405F12; }
    .tag-orange { color: #FF9500; background: #FF950015; }
    .result-title { font-size: 14px; font-weight: 700; color: #0D405F; line-height: 1.4; }
    .result-desc { font-size: 13px; color: #475569; line-height: 1.6; }
    .paa-card { border-left: 4px solid #FF9500; }
    .paa-list { margin: 0; padding: 0 0 0 18px; }
    .paa-list li { color: #334155; font-size: 13px; line-height: 2; border-bottom: 1px solid #f1f5f9; }
    .paa-list li:last-child { border-bottom: none; }
    .total { font-size: 11px; color: #94a3b8; margin-left: 8px; }

    /* Modal */
    .modal-bg { position: fixed; inset: 0; background: #0008; z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 16px; }
    .modal { background: #fff; border-radius: 14px; padding: 24px; width: 100%; max-width: 560px; box-shadow: 0 8px 40px #0004; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
    .modal-title { font-weight: 700; color: #0D405F; font-size: 15px; }
    .modal-close { background: none; border: none; font-size: 20px; cursor: pointer; color: #94a3b8; }
    .modal textarea { width: 100%; height: 220px; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; padding: 12px; font-size: 13px; color: #1e293b; resize: none; outline: none; line-height: 1.7; font-family: inherit; }
    .hidden { display: none; }
  </style>
</head>
<body>
<div class="wrap">

  <!-- Header -->
  <div class="header">
    <div class="logo">üîç</div>
    <div>
      <h1>SERP Parser</h1>
      <div class="subtitle">Google France via SerpAPI üá´üá∑</div>
    </div>
  </div>

  <!-- Config -->
  <div class="card">
    <span class="label">üîë Cl√© API SerpAPI</span>
    <input type="password" id="apiKey" placeholder="Colle ta cl√© SerpAPI ici‚Ä¶" oninput="checkReady()" />
    <div id="keyOk" class="ok hidden">‚úÖ Cl√© renseign√©e</div>
  </div>

  <!-- Search -->
  <div class="card">
    <span class="label">Requ√™te de recherche</span>
    <div class="search-row">
      <input type="text" id="query" placeholder="Ex : meilleur logiciel SEO 2024‚Ä¶" oninput="checkReady()" onkeydown="if(event.key==='Enter') doSearch()" />
      <button class="btn-orange" id="searchBtn" onclick="doSearch()" disabled>‚ö° Lancer</button>
    </div>
    <div class="hint">üá´üá∑ France ¬∑ Fran√ßais ¬∑ 10 r√©sultats ¬∑ Entr√©e pour lancer</div>
  </div>

  <!-- Error -->
  <div id="error" class="error hidden"></div>

  <!-- Loading -->
  <div id="loading" class="card loading hidden">
    <div class="icon">‚è≥</div>
    <div class="title">Interrogation de Google‚Ä¶</div>
    <div class="sub">Via SerpAPI ¬∑ Proxy Vercel</div>
  </div>

  <!-- PAA -->
  <div id="paaSection" class="card paa-card hidden">
    <div class="section-header">
      <div>
        <span class="section-title section-title-orange">People Also Ask</span>
        <span class="badge badge-orange" id="paaCount"></span>
      </div>
      <button class="btn-orange" onclick="copyPAA()">üìã Copier les PAA</button>
    </div>
    <ol class="paa-list" id="paaList"></ol>
  </div>

  <!-- Results -->
  <div id="resultsSection" class="card hidden">
    <div class="section-header">
      <div>
        <span class="section-title">R√©sultats organiques</span>
        <span class="badge" id="resCount"></span>
        <span class="total" id="totalRes"></span>
      </div>
      <div class="btns">
        <button class="btn-blue" onclick="copyTitles()">üìã Titles</button>
        <button class="btn-orange" onclick="copyDescs()">üìã Meta-desc</button>
      </div>
    </div>
    <div id="resultsList"></div>
  </div>

</div>

<!-- Modal -->
<div id="modalBg" class="modal-bg hidden" onclick="closeModal()">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <span class="modal-title" id="modalTitle"></span>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <textarea id="modalText" readonly></textarea>
    <br/><br/>
    <button class="btn-blue" onclick="selectAll()">üñ±Ô∏è Tout s√©lectionner (puis Ctrl+C)</button>
  </div>
</div>

<script>
  const PROXY = "https://serp-proxy-beta.vercel.app/api/search";
  let resultsData = [], paaData = [];

  function checkReady() {
    const ok = document.getElementById('apiKey').value.trim() && document.getElementById('query').value.trim();
    document.getElementById('searchBtn').disabled = !ok;
    document.getElementById('keyOk').classList.toggle('hidden', !document.getElementById('apiKey').value.trim());
  }

  function show(id) { document.getElementById(id).classList.remove('hidden'); }
  function hide(id) { document.getElementById(id).classList.add('hidden'); }

  async function doSearch() {
    const key = document.getElementById('apiKey').value.trim();
    const q = document.getElementById('query').value.trim();
    if (!key || !q) return;

    hide('error'); hide('paaSection'); hide('resultsSection'); show('loading');

    try {
      const url = `${PROXY}?key=${encodeURIComponent(key)}&q=${encodeURIComponent(q)}&gl=fr&hl=fr&num=10`;
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Erreur HTTP ${res.status}`);
      const data = await res.json();
      if (data.error) throw new Error(typeof data.error === 'string' ? data.error : JSON.stringify(data.error));

      resultsData = (data.organic_results || []).map(r => ({
        title: r.title || '',
        url: r.link || '',
        source: r.displayed_link || '',
        desc: r.snippet ? r.snippet.replace(/\n/g, ' ').trim() : ''
      }));

      paaData = (data.related_questions || []).map(r => r.question).filter(Boolean);

      const total = data.search_information?.total_results;

      hide('loading');

      // PAA
      if (paaData.length) {
        document.getElementById('paaCount').textContent = paaData.length;
        const ul = document.getElementById('paaList');
        ul.innerHTML = paaData.map(q => `<li>${q}</li>`).join('');
        show('paaSection');
      }

      // Results
      if (resultsData.length) {
        document.getElementById('resCount').textContent = resultsData.length;
        document.getElementById('totalRes').textContent = total ? `‚âà ${parseInt(total).toLocaleString('fr-FR')} r√©sultats Google` : '';
        const list = document.getElementById('resultsList');
        list.innerHTML = resultsData.map((r, i) => `
          <div class="result-card">
            <div class="result-meta">
              <span class="pos">#${i+1}</span>
              ${r.source ? `<span class="source">${r.source}</span>` : ''}
              <a class="url" href="${r.url}" target="_blank" rel="noreferrer">${r.url}</a>
            </div>
            <div class="row">
              <span class="tag tag-blue">Title</span>
              <span class="result-title">${r.title}</span>
            </div>
            <div class="row">
              <span class="tag tag-orange">Meta</span>
              <span class="result-desc">${r.desc || '<em style="color:#cbd5e1">non d√©tect√©e</em>'}</span>
            </div>
          </div>
        `).join('');
        show('resultsSection');
      }

    } catch(e) {
      hide('loading');
      const el = document.getElementById('error');
      el.textContent = '‚ùå ' + e.message;
      show('error');
    }
  }

  function openModal(title, text) {
    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalText').value = text;
    show('modalBg');
  }
  function closeModal() { hide('modalBg'); }
  function selectAll() { const t = document.getElementById('modalText'); t.select(); t.focus(); }

  function copyTitles() { openModal('üìã Titles', resultsData.map(r => r.title).join('\n')); }
  function copyDescs() { openModal('üìã Meta-descriptions', resultsData.map(r => r.desc || '‚Äî').join('\n')); }
  function copyPAA() { openModal('üìã People Also Ask', paaData.map((q,i) => `${i+1}. ${q}`).join('\n')); }
</script>
</body>
</html>
